# AWS IAM/S3 設定手順（複数バケット共有キー）

このドキュメントは、1つのAWSアクセスキーで複数のS3バケットを読み取りできるようにするための
IAMユーザー作成・ポリシー設定手順をまとめたものです。

## 1. IAMユーザーの作成
1. AWSコンソール → IAM → 「ユーザー」 → 「ユーザーを追加」
2. ユーザー名を入力（例: `mailer-s3-reader`）
3. 作成（この時点ではアクセスキーは作らない）

## 2. ポリシーを作成（複数バケット）
1. IAM → 「ポリシー」 → 「ポリシーの作成」
2. JSON タブに以下を貼り付け

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "ListBuckets",
      "Effect": "Allow",
      "Action": ["s3:ListBucket"],
      "Resource": [
        "arn:aws:s3:::bucket-a",
        "arn:aws:s3:::bucket-b"
      ]
    },
    {
      "Sid": "ReadObjects",
      "Effect": "Allow",
      "Action": ["s3:GetObject"],
      "Resource": [
        "arn:aws:s3:::bucket-a/*",
        "arn:aws:s3:::bucket-b/*"
      ]
    }
  ]
}
```

3. `bucket-a` / `bucket-b` を実際のバケット名に置き換え
4. ポリシー名を入力（例: `mailer-s3-read-multi`）
5. 作成

## 3. IAMユーザーへポリシー付与
1. IAM → 「ユーザー」 → 作成したユーザー
2. 「許可を追加」
3. 上で作成したポリシーを選択して付与

## 4. アクセスキーの作成（新しいIAMコンソール手順）
1. IAM → 「ユーザー」 → 作成したユーザーを開く
2. 「セキュリティ認証情報」タブ
3. 「アクセスキー」セクションで「アクセスキーを作成」
4. 「ユースケースを選択」画面で該当する用途を選ぶ
   - 例: 「アプリケーションがAWS外部で実行される」を選択
5. 作成後に表示される `Access Key ID` と `Secret Access Key` を控える
   - Secret は再表示できません

## 5. アプリ側の使い方
- 同じアクセスキーで、バケット名だけ異なるS3ドメインを複数作成します
- 受信画面の「ドメイン切替」でバケットを切り替えできます
